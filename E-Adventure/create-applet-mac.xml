<?xml version="1.0" encoding="UTF-8"?>

<project basedir="." default="generate" name="build.eAdventureApplet">
	<description>
    This ant build file is used to build the project as a jar file.
	</description>
	
	<property name="lib.dir" value="jars" />
	<property name="gui.dir" value="gui" />
	<property name="img.dir" value="img" />
	<property name="web.dir" value="web" />
	<property name="lanengine.dir" value="lanengine" />
	<property name="laneditor.dir" value="laneditor" />
	<property name="release.version" value="1.0" />

	<path id="project.class.path">
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
		</fileset>
	</path>

	<target name="compile">
		<mkdir dir="./web/tempcompile/" />
		<javac srcdir="./src/es/eucm/eadventure/" destdir="./web/tempcompile/" source="1.5" target="1.5">
			<classpath refid="project.class.path" />
		</javac>
		
	</target>


	<target name="cleanup">
		<delete file="web/eAdventure_S.jar" />
		<delete file="web/eAdventure.jar" />
		<delete>
			<fileset dir="web">
				<include name="temp/**/*.*"/>
				<include name="tempcompile/**/*.*"/>
			</fileset>
		</delete>
		<delete dir="web/tempcompile"/>
		<delete dir="web/temp/es"/>
		<delete dir="web/temp/gui"/>
		<delete dir="web/temp/lanengine"/>
	</target>

	<target name="jar" depends="compile" description="generate the eadventure applet">
		<delete file="web/eAdventure_temp.jar" />
		<delete file="web/eAdventure.jar" />
		<copy todir="web/temp">
			<fileset dir=".">
				<!--<include name="eadventure.dtd" />
				<include name="descriptor.dtd" />
				<include name="adaptation.dtd" />
				<include name="assessment.dtd" />-->
				
				<include name="gui/**" />
				<include name="lanengine/en_EN.xml" />
				<include name="java.policy.applet" />
			</fileset>
			<fileset dir="./web/tempcompile">
				<include name="**" />
			</fileset>
		</copy>
		<jar compress="true" destfile="web/eAdventure.jar">
			<fileset dir="web/temp">
				<exclude name="CVS/**" />
				<exclude name=".svn/**" />
				<include name="**" />
			</fileset>
			<zipfileset src="jars/truezip-6.jar" />
			<zipfileset src="jars/tritonus_share.jar" />
			<zipfileset src="jars/plugin.jar" />
			<zipfileset src="jars/mp3spi1.9.4.jar" />
			<zipfileset src="jars/jmf.jar" />
			<zipfileset src="jars/jl1.0.jar" />
			<zipfileset src="jars/jffmpeg-1.1.0.jar" />
			<zipfileset src="jars/cmu_time_awb.jar" />
			<zipfileset src="jars/cmu_us_kal.jar"/>
			<zipfileset src="jars/cmudict04.jar" />
			<zipfileset src="jars/cmulex.jar" />
			<zipfileset src="jars/cmutimelex.jar" />
			<zipfileset src="jars/en_us.jar" />
			<zipfileset src="jars/freetts.jar" />
			<zipfileset src="jars/mailapi.jar" />
			<zipfileset src="jars/smtp.jar" />
			<!--<zipfileset src="jars/kafenio-config.jar" />
			<zipfileset src="jars/kafenio-icons.jar" />
			<zipfileset src="jars/kafenio.jar" />-->
			
			<manifest>
				<attribute name="Main-Class" value="es.eucm.eadventure.engine.EAdventureApplet" />
			</manifest>

		</jar>

		<zip destfile="web/eAdventure_temp.jar"> 
		        <zipfileset src="web/eAdventure.jar"> 
		                <exclude name="**/MANIFEST.MF" /> 
		        </zipfileset> 
		</zip>
		
	</target>
	
	<target name="sign">
		
		<exec executable="cmd" inputstring ="mypass">
			<arg value="/c"/>
			<arg value="C:/Datos/workspace/EAdventure2D/web/signapplet.bat"/>
			<arg value="-p"/>
			
		</exec>
		
	</target>
	
	<target name="launchweb">
		<exec executable ="C:\Program Files (x86)\Internet Explorer\iexplore.exe">
			<arg value="C:\Datos\workspace\EAdventure2D\web\eGame.html"/>
			
		</exec>
	</target>
	
	<!--<target name="sign" description="sign the eadventure applet">
		<signjar jar="web/eAdventure.jar" alias="TestCert" storepass="mypass"/>
	</target>-->
	

	<target name="generate" description="Clean and Generate">
		<antcall target="cleanup"></antcall>
		<antcall target="jar"></antcall>
		<antcall target="cleanup"></antcall>
	</target>
</project>
